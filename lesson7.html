<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>第7課：單字朗讀練習</title>
  <style>
    body {
      font-family: 'Arial','Hiragino Kaku Gothic ProN','游ゴシック',sans-serif;
      background-color: #fff0f5; color:#333; padding:2rem;
    }
    header { display:grid; grid-template-columns: 1fr auto; gap:1rem; align-items:center; margin-bottom:.8rem; }
    h1 { color:#d26fa0; font-size:2rem; margin:0; }

    .controls { display:flex; flex-wrap:wrap; gap:.6rem .8rem; align-items:center; justify-content:flex-end; }
    .pill,.seg { background:#fff; border:1px solid #f0cde3; box-shadow:0 0 8px #e3a5c7; color:#c04583; }
    .pill { display:inline-flex; align-items:center; gap:.5rem; border-radius:999px; padding:.35rem .7rem; font-size:.9rem; user-select:none; }
    .pill input[type="checkbox"]{
      width:46px; height:24px; appearance:none; outline:none; background:#f8d8e9; border-radius:999px;
      position:relative; cursor:pointer; transition:background .2s ease;
    }
    .pill input[type="checkbox"]::after{
      content:""; position:absolute; width:20px; height:20px; top:2px; left:2px; background:#fff; border-radius:50%;
      box-shadow:0 1px 4px rgba(0,0,0,.2); transition:left .2s ease;
    }
    .pill input[type="checkbox"]:checked{ background:#ffaad4; }
    .pill input[type="checkbox"]:checked::after{ left:24px; }

    .search { border-radius:999px; padding:.4rem .8rem; display:inline-flex; align-items:center; gap:.5rem; }
    .search input{ border:none; outline:none; background:transparent; min-width:12rem; color:#333; }

    .sliders { display:inline-flex; gap:.8rem; align-items:center; flex-wrap:wrap; border-radius:999px; padding:.4rem .8rem; font-size:.9rem; }
    .sliders label{ display:flex; align-items:center; gap:.4rem; }
    .sliders input[type="range"]{ width:120px; }

    .seg{ display:inline-flex; border-radius:999px; overflow:hidden; }
    .seg button{ border:none; background:transparent; padding:.45rem .9rem; cursor:pointer; color:#c04583; font-weight:600; }
    .seg button+button{ border-left:1px solid #f0cde3; }
    .seg button.active{ background:#ffaad4; color:#fff; }

    table{ width:100%; border-collapse:collapse; background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 0 12px #e3a5c7; margin-top:.6rem; }
    th,td{ padding:.8rem; text-align:left; border-bottom:1px solid #f0cde3; vertical-align:top; }
    th{ background:#f8d8e9; color:#c04583; }
    td.jp:hover{ cursor:pointer; background:#ffeaf5; }

    /* 假名切換：隱藏所有 rt */
    .hide-kana rt{ display:none; }

    /* 練習模式：隱藏中/日欄位（th、td都加上 jp-col / cn-col） */
    .mode-cn .cn-col{ display:none; } /* 日→中（先看日文）：隱中文欄 */
    .mode-jp .jp-col{ display:none; } /* 中→日（先看中文）：隱日文欄 */

    .button-home{ margin-top:2rem; text-align:center; }
    .button-home a{
      background:#ffaad4; color:#fff; padding:.8rem 1.5rem; text-decoration:none; border-radius:20px; font-weight:bold;
      box-shadow:0 4px 8px rgba(0,0,0,.1);
    }
    .button-home a:hover{ background:#f98fc3; }

    ruby{ ruby-position:under; }
  </style>
</head>
<body>
  <header>
    <h1>📘 第7課：單字＋例句朗讀練習</h1>
    <div class="controls">
      <label class="search pill" title="輸入以即時篩選（日/中皆可）">
        🔎 <input id="searchInput" type="text" placeholder="搜尋單字/意思/例句…"/>
      </label>

      <!-- 假名切換 -->
      <label class="pill" title="切換顯示/隱藏假名（ふりがな）">假名
        <input id="kanaToggle" type="checkbox"/>
      </label>

      <!-- 朗讀控制 -->
      <div class="sliders pill" title="調整朗讀速度與音量（會記住偏好）">
        <label>速度 <input id="rate" type="range" min="0.6" max="1.6" step="0.1" value="1"></label>
        <label>音量 <input id="volume" type="range" min="0" max="1" step="0.05" value="1"></label>
      </div>

      <!-- 練習模式 Segmented -->
      <div class="seg" id="modeSeg" role="tablist" aria-label="練習模式">
        <button type="button" data-mode="both" class="active" aria-selected="true">顯示全部</button>
        <button type="button" data-mode="cn" aria-selected="false">日→中（隱藏中文）</button>
        <button type="button" data-mode="jp" aria-selected="false">中→日（隱藏日文）</button>
      </div>
    </div>
  </header>

  <table id="vocabTable">
    <tr>
      <th class="jp-col">單字（日文）</th>
      <th class="cn-col">中文意思</th>
      <th class="jp-col">例句（日文）</th>
      <th class="cn-col">中文翻譯</th>
    </tr>

    <!-- 第7課詞表（加上 jp/jp-col 與 cn-col；適度加入 ruby 以支援假名顯示開關） -->
    <tr><td class="jp jp-col" onclick="speakJP('きります')">きります（<ruby><rb>切</rb><rt>き</rt></ruby>ります）</td><td class="cn-col">剪、切</td><td class="jp jp-col" onclick="speakJP('はさみで かみを きります。')">はさみで かみを きります。</td><td class="cn-col">用剪刀剪紙。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('おくります')">おくります（<ruby><rb>送</rb><rt>おく</rt></ruby>ります）</td><td class="cn-col">寄、送</td><td class="jp jp-col" onclick="speakJP('ともだちに プレゼントを おくります。')">ともだちに プレゼントを おくります。</td><td class="cn-col">送禮物給朋友。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('あげます')">あげます</td><td class="cn-col">給</td><td class="jp jp-col" onclick="speakJP('せんせいに おかしを あげます。')">せんせいに おかしを あげます。</td><td class="cn-col">給老師點心。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('もらいます')">もらいます</td><td class="cn-col">得到</td><td class="jp jp-col" onclick="speakJP('ともだちに はなを もらいます。')">ともだちに はなを もらいます。</td><td class="cn-col">收到朋友送的花。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('かします')">かします（<ruby><rb>貸</rb><rt>か</rt></ruby>します）</td><td class="cn-col">借給</td><td class="jp jp-col" onclick="speakJP('ともだちに おかねを かします。')">ともだちに おかねを かします。</td><td class="cn-col">借錢給朋友。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('かります')">かります（<ruby><rb>借</rb><rt>か</rt></ruby>ります）</td><td class="cn-col">借</td><td class="jp jp-col" onclick="speakJP('ともだちから ほんを かります。')">ともだちから ほんを かります。</td><td class="cn-col">向朋友借書。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('おしえます')">おしえます（<ruby><rb>教</rb><rt>おし</rt></ruby>えます）</td><td class="cn-col">教、告訴</td><td class="jp jp-col" onclick="speakJP('にほんごを おしえます。')">にほんごを おしえます。</td><td class="cn-col">教日文。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('ならいます')">ならいます（<ruby><rb>習</rb><rt>なら</rt></ruby>います）</td><td class="cn-col">學習</td><td class="jp jp-col" onclick="speakJP('ピアノを ならいます。')">ピアノを ならいます。</td><td class="cn-col">學鋼琴。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('かけます')">かけます</td><td class="cn-col">打［電話］</td><td class="jp jp-col" onclick="speakJP('でんわを かけます。')">でんわを かけます。</td><td class="cn-col">打電話。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('て')">て（<ruby><rb>手</rb><rt>て</rt></ruby>）</td><td class="cn-col">手</td><td class="jp jp-col" onclick="speakJP('てで たべます。')">てで たべます。</td><td class="cn-col">用手吃。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('はし')">はし</td><td class="cn-col">筷子</td><td class="jp jp-col" onclick="speakJP('はしで ごはんを たべます。')">はしで ごはんを たべます。</td><td class="cn-col">用筷子吃飯。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('スプーン')">スプーン</td><td class="cn-col">湯匙</td><td class="jp jp-col" onclick="speakJP('スプーンで スープを のみます。')">スプーンで スープを のみます。</td><td class="cn-col">用湯匙喝湯。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('ナイフ')">ナイフ</td><td class="cn-col">刀子</td><td class="jp jp-col" onclick="speakJP('ナイフで にくを きります。')">ナイフで にくを きります。</td><td class="cn-col">用刀子切肉。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('フォーク')">フォーク</td><td class="cn-col">叉子</td><td class="jp jp-col" onclick="speakJP('フォークで パスタを たべます。')">フォークで パスタを たべます。</td><td class="cn-col">用叉子吃義大利麵。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('はさみ')">はさみ</td><td class="cn-col">剪刀</td><td class="jp jp-col" onclick="speakJP('はさみで かみを きります。')">はさみで かみを きります。</td><td class="cn-col">用剪刀剪紙。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('パソコン')">パソコン</td><td class="cn-col">個人電腦</td><td class="jp jp-col" onclick="speakJP('まいにち パソコンを つかいます。')">まいにち パソコンを つかいます。</td><td class="cn-col">每天使用電腦。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('ケータイ')">ケータイ</td><td class="cn-col">手機</td><td class="jp jp-col" onclick="speakJP('ケータイで でんわを かけます。')">ケータイで でんわを かけます。</td><td class="cn-col">用手機打電話。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('メール')">メール</td><td class="cn-col">電子郵件</td><td class="jp jp-col" onclick="speakJP('ともだちに メールを おくります。')">ともだちに メールを おくります。</td><td class="cn-col">寄電子郵件給朋友。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('ねんがじょう')">ねんがじょう（<ruby><rb>年賀状</rb><rt>ねんがじょう</rt></ruby>）</td><td class="cn-col">賀年卡</td><td class="jp jp-col" onclick="speakJP('ねんがじょうを かきます。')">ねんがじょうを かきます。</td><td class="cn-col">寫賀年卡。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('パンチ')">パンチ</td><td class="cn-col">打洞機</td><td class="jp jp-col" onclick="speakJP('パンチで あなを あけます。')">パンチで あなを あけます。</td><td class="cn-col">用打洞機打洞。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('ホッチキス')">ホッチキス</td><td class="cn-col">釘書機</td><td class="jp jp-col" onclick="speakJP('ホッチキスで とじます。')">ホッチキスで とじます。</td><td class="cn-col">用釘書機裝訂。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('セロテープ')">セロテープ</td><td class="cn-col">透明膠帶</td><td class="jp jp-col" onclick="speakJP('セロテープで はります。')">セロテープで はります。</td><td class="cn-col">用膠帶貼上。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('けしゴム')">けしゴム（<ruby><rb>消</rb><rt>け</rt></ruby>しゴム）</td><td class="cn-col">橡皮擦</td><td class="jp jp-col" onclick="speakJP('まちがえを けしゴムで けします。')">まちがえを けしゴムで けします。</td><td class="cn-col">用橡皮擦擦錯誤。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('かみ')">かみ（<ruby><rb>紙</rb><rt>かみ</rt></ruby>）</td><td class="cn-col">紙</td><td class="jp jp-col" onclick="speakJP('かみに じを かきます。')">かみに じを かきます。</td><td class="cn-col">在紙上寫字。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('はな')">はな（<ruby><rb>花</rb><rt>はな</rt></ruby>）</td><td class="cn-col">花</td><td class="jp jp-col" onclick="speakJP('はなを かいます。')">はなを かいます。</td><td class="cn-col">買花。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('シャツ')">シャツ</td><td class="cn-col">襯衫</td><td class="jp jp-col" onclick="speakJP('あたらしい シャツを かいます。')">あたらしい シャツを かいます。</td><td class="cn-col">買新的襯衫。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('プレゼント')">プレゼント</td><td class="cn-col">禮物</td><td class="jp jp-col" onclick="speakJP('たんじょうびに プレゼントを あげます。')">たんじょうびに プレゼントを あげます。</td><td class="cn-col">生日時送禮物。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('にもつ')">にもつ（<ruby><rb>荷物</rb><rt>にもつ</rt></ruby>）</td><td class="cn-col">行李、包裹</td><td class="jp jp-col" onclick="speakJP('おおきい にもつが あります。')">おおきい にもつが あります。</td><td class="cn-col">有大件行李。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('おかね')">おかね（<ruby><rb>お金</rb><rt>おかね</rt></ruby>）</td><td class="cn-col">錢</td><td class="jp jp-col" onclick="speakJP('おかねが いります。')">おかねが いります。</td><td class="cn-col">需要錢。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('きっぷ')">きっぷ（<ruby><rb>切符</rb><rt>きっぷ</rt></ruby>）</td><td class="cn-col">車票、入場券</td><td class="jp jp-col" onclick="speakJP('きっぷを かいます。')">きっぷを かいます。</td><td class="cn-col">買票。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('クリスマス')">クリスマス</td><td class="cn-col">聖誕節</td><td class="jp jp-col" onclick="speakJP('クリスマスに パーティーを します。')">クリスマスに パーティーを します。</td><td class="cn-col">聖誕節辦派對。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('ちち')">ちち（<ruby><rb>父</rb><rt>ちち</rt></ruby>）</td><td class="cn-col">家父</td><td class="jp jp-col" onclick="speakJP('これは ちちです。')">これは ちちです。</td><td class="cn-col">這是我爸爸。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('はは')">はは（<ruby><rb>母</rb><rt>はは</rt></ruby>）</td><td class="cn-col">家母</td><td class="jp jp-col" onclick="speakJP('ははは せんせいです。')">ははは せんせいです。</td><td class="cn-col">我媽媽是老師。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('おとうさん')">おとうさん（<ruby><rb>お父</rb><rt>おとう</rt></ruby>さん）</td><td class="cn-col">（別人的）父親，也可稱呼自己父親</td><td class="jp jp-col" onclick="speakJP('おとうさんは いま いえに います。')">おとうさんは いま いえに います。</td><td class="cn-col">爸爸現在在家。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('おかあさん')">おかあさん（<ruby><rb>お母</rb><rt>おかあ</rt></ruby>さん）</td><td class="cn-col">（別人的）母親，也可稱呼自己母親</td><td class="jp jp-col" onclick="speakJP('おかあさんは しごとに いきました。')">おかあさんは しごとに いきました。</td><td class="cn-col">媽媽去工作了。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('もう')">もう</td><td class="cn-col">已經</td><td class="jp jp-col" onclick="speakJP('もう ごはんを たべました。')">もう ごはんを たべました。</td><td class="cn-col">已經吃過飯了。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('まだ')">まだ</td><td class="cn-col">尚未、還沒</td><td class="jp jp-col" onclick="speakJP('まだ たべていません。')">まだ たべていません。</td><td class="cn-col">還沒吃。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('これから')">これから</td><td class="cn-col">從現在起（要去做某事）</td><td class="jp jp-col" onclick="speakJP('これから かいものに いきます。')">これから かいものに いきます。</td><td class="cn-col">接下來要去買東西。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('いらっしゃい')">いらっしゃい。</td><td class="cn-col">歡迎。</td><td class="jp jp-col" onclick="speakJP('いらっしゃい。どうぞ。')">いらっしゃい。どうぞ。</td><td class="cn-col">歡迎，請進。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('どうぞおあがりください')">どうぞおあがりください。</td><td class="cn-col">請進。</td><td class="jp jp-col" onclick="speakJP('どうぞ おあがりください。')">どうぞ おあがりください。</td><td class="cn-col">請進。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('しつれいします')">しつれいします（<ruby><rb>失礼</rb><rt>しつれい</rt></ruby>します）</td><td class="cn-col">打擾了。</td><td class="jp jp-col" onclick="speakJP('おじゃまします。しつれいします。')">おじゃまします。しつれいします。</td><td class="cn-col">打擾了，失禮了。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('〜は いかがですか')">〜は いかがですか。</td><td class="cn-col">你覺得〜怎麼樣？</td><td class="jp jp-col" onclick="speakJP('おちゃは いかがですか。')">おちゃは いかがですか。</td><td class="cn-col">要不要喝杯茶呢？</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('いただきます')">いただきます。</td><td class="cn-col">我開動了（用於用餐前）</td><td class="jp jp-col" onclick="speakJP('いただきます。')">いただきます。</td><td class="cn-col">我開動了。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('ごちそうさまでした')">ごちそうさまでした。</td><td class="cn-col">我吃飽了／謝謝招待（用於用餐後）</td><td class="jp jp-col" onclick="speakJP('ごちそうさまでした。')">ごちそうさまでした。</td><td class="cn-col">謝謝你的招待。</td></tr>
    <tr><td class="jp jp-col" onclick="speakJP('すてきですね')">〜、すてきですね。</td><td class="cn-col">〜真不錯啊！</td><td class="jp jp-col" onclick="speakJP('そのシャツ、すてきですね。')">そのシャツ、すてきですね。</td><td class="cn-col">那件襯衫真不錯啊！</td></tr>
  </table>

  <div class="button-home">
    <a href="index.html">回首頁 🏠</a>
  </div>

  <script>
    let voicesLoaded = false;

    // 偏好 keys（與第1課一致，讓偏好可共用）
    const KANA_KEY = 'showKana';
    const RATE_KEY = 'ttsRate';
    const VOL_KEY  = 'ttsVolume';
    const MODE_KEY = 'practiceMode'; // 'both' | 'cn' | 'jp'

    function getRate(){ const r=parseFloat(localStorage.getItem(RATE_KEY) ?? '1'); return isNaN(r)?1:r; }
    function getVolume(){ const v=parseFloat(localStorage.getItem(VOL_KEY) ?? '1'); return isNaN(v)?1:v; }

    function speakJP(text){
      if(!voicesLoaded){
        window.speechSynthesis.onvoiceschanged = ()=>{ voicesLoaded = true; speakJP(text); };
        speechSynthesis.getVoices(); return;
      }
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ja-JP';
      u.rate = getRate();
      u.volume = getVolume();
      const v = speechSynthesis.getVoices().find(voice=>voice.lang==='ja-JP');
      if(v) u.voice = v;
      speechSynthesis.speak(u);
    }

    // 假名切換
    function applyKanaPreference(show){
      document.body.classList.toggle('hide-kana', !show);
      const toggle=document.getElementById('kanaToggle');
      if(toggle) toggle.checked = show;
    }

    // 練習模式（顯示全部 / 日→中 / 中→日）
    function applyPracticeMode(mode){
      document.body.classList.remove('mode-cn','mode-jp');
      if(mode==='cn') document.body.classList.add('mode-cn'); // 隱中文
      if(mode==='jp') document.body.classList.add('mode-jp'); // 隱日文
      document.querySelectorAll('#modeSeg button').forEach(btn=>{
        const active = btn.dataset.mode===mode;
        btn.classList.toggle('active', active);
        btn.setAttribute('aria-selected', String(active));
      });
    }

    // 即時搜尋
    function setupSearch(){
      const input=document.getElementById('searchInput');
      const rows = Array.from(document.querySelectorAll('#vocabTable tr')).slice(1);
      input.addEventListener('input', ()=>{
        const q=input.value.trim().toLowerCase();
        rows.forEach(tr=>{
          const hit = tr.textContent.toLowerCase().includes(q);
          tr.style.display = hit ? '' : 'none';
        });
      });
    }

    // 讓所有 .jp 欄位點擊即可朗讀（日文）
    function delegateSpeak(){
      document.addEventListener('click', e=>{
        const td = e.target.closest('td.jp');
        if(!td) return;
        const txt = td.innerText.replace(/[（）\[\]]/g, '').trim();
        if(txt){
          speechSynthesis.cancel();
          setTimeout(()=>speakJP(txt), 80);
        }
      });
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      // 初始化語音
      const checkVoices=()=>{ if(speechSynthesis.getVoices().length>0){ voicesLoaded=true; } else setTimeout(checkVoices,120); };
      checkVoices();

      // 假名偏好
      const savedKana = localStorage.getItem(KANA_KEY);
      const showKana = savedKana===null ? true : savedKana==='true';
      applyKanaPreference(showKana);
      document.getElementById('kanaToggle').addEventListener('change', e=>{
        const show=e.target.checked;
        applyKanaPreference(show);
        localStorage.setItem(KANA_KEY, String(show));
      });

      // 朗讀偏好
      const rateEl=document.getElementById('rate');
      const volEl =document.getElementById('volume');
      rateEl.value = String(getRate());
      volEl.value  = String(getVolume());
      rateEl.addEventListener('input', ()=> localStorage.setItem(RATE_KEY, rateEl.value));
      volEl.addEventListener('input',  ()=> localStorage.setItem(VOL_KEY,  volEl.value));

      // 練習模式（與第1課共用 key）
      const savedMode = localStorage.getItem(MODE_KEY) ?? 'both';
      applyPracticeMode(savedMode);
      document.querySelectorAll('#modeSeg button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const mode = btn.dataset.mode;
          applyPracticeMode(mode);
          localStorage.setItem(MODE_KEY, mode);
        });
      });

      // 搜尋與點擊朗讀
      setupSearch();
      delegateSpeak();
    });
  </script>
</body>
</html>
