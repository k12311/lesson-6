<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç¬¬8èª²ï¼šå–®å­—æœ—è®€ç·´ç¿’</title>
  <style>
    body { font-family: 'Arial','Hiragino Kaku Gothic ProN','æ¸¸ã‚´ã‚·ãƒƒã‚¯',sans-serif; background:#fff0f5; color:#333; padding:2rem; }
    header { display:grid; grid-template-columns: 1fr auto; gap:1rem; align-items:center; margin-bottom:.8rem; }
    h1 { color:#d26fa0; font-size:1.8rem; margin:0; }
    .controls { display:flex; flex-wrap:wrap; gap:.6rem .8rem; align-items:center; justify-content:flex-end; }

    .pill,.seg { background:#fff; border:1px solid #f0cde3; box-shadow:0 0 8px #e3a5c7; color:#c04583; }
    .pill { display:inline-flex; align-items:center; gap:.5rem; border-radius:999px; padding:.35rem .7rem; font-size:.95rem; user-select:none; }

    .pill input[type="checkbox"]{ width:46px; height:24px; appearance:none; outline:none; background:#f8d8e9; border-radius:999px; position:relative; cursor:pointer; transition:background .2s; }
    .pill input[type="checkbox"]::after{ content:""; position:absolute; width:20px; height:20px; top:2px; left:2px; background:#fff; border-radius:50%; box-shadow:0 1px 4px rgba(0,0,0,.2); transition:left .2s; }
    .pill input[type="checkbox"]:checked{ background:#ffaad4; }
    .pill input[type="checkbox"]:checked::after{ left:24px; }

    .search { border-radius:999px; padding:.4rem .8rem; display:inline-flex; align-items:center; gap:.5rem; }
    .search input { border:none; outline:none; background:transparent; min-width:12rem; color:#333; }

    .sliders { display:inline-flex; gap:.8rem; align-items:center; flex-wrap:wrap; border-radius:999px; padding:.4rem .8rem; font-size:.95rem; }
    .sliders label{ display:flex; align-items:center; gap:.4rem; }
    .sliders input[type="range"]{ width:120px; }

    /* Segmented control */
    .seg{ display:inline-flex; border-radius:999px; overflow:hidden; }
    .seg button{ border:none; background:transparent; padding:.45rem .9rem; cursor:pointer; color:#c04583; font-weight:600; }
    .seg button+button{ border-left:1px solid #f0cde3; }
    .seg button.active{ background:#ffaad4; color:#fff; }

    table { width:100%; border-collapse:collapse; background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 0 12px #e3a5c7; }
    th, td { padding:0.8rem; text-align:left; border-bottom:1px solid #f0cde3; vertical-align:top; }
    th { background:#f8d8e9; color:#c04583; }
    td.jp:hover { cursor:pointer; background-color:#ffeaf5; }

    /* å‡åé¡¯ç¤ºåˆ‡æ›ï¼šéš±è— <rt> */
    .hide-kana rt { display:none; }
    ruby { ruby-position: under; }

    /* å–®å‘ç·´ç¿’æ¨¡å¼ï¼ˆç”¨ nth-child ç›´æ¥éš±è—æ•´æ¬„ï¼Œå…å»é€æ ¼åŠ  classï¼‰ */
    /* æ—¥â†’ä¸­ï¼ˆéš±ä¸­æ–‡ï¼šç¬¬2ã€4æ¬„ï¼‰ */
    .mode-cn th:nth-child(2), .mode-cn td:nth-child(2),
    .mode-cn th:nth-child(4), .mode-cn td:nth-child(4){ display:none; }
    /* ä¸­â†’æ—¥ï¼ˆéš±æ—¥æ–‡ï¼šç¬¬1ã€3æ¬„ï¼‰ */
    .mode-jp th:nth-child(1), .mode-jp td:nth-child(1),
    .mode-jp th:nth-child(3), .mode-jp td:nth-child(3){ display:none; }

    .button-home{ margin-top:2rem; text-align:center; }
    .button-home a{ background:#ffaad4; color:#fff; padding:.8rem 1.5rem; text-decoration:none; border-radius:20px; font-weight:bold; box-shadow:0 4px 8px rgba(0,0,0,.1); }
    .button-home a:hover{ background:#f98fc3; }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ“˜ ç¬¬8èª²ï¼šå–®å­—ï¼‹ä¾‹å¥æœ—è®€ç·´ç¿’</h1>
    <div class="controls">
      <label class="search pill" title="è¼¸å…¥ä»¥å³æ™‚ç¯©é¸ï¼ˆæ—¥/ä¸­çš†å¯ï¼‰">
        ğŸ” <input id="searchInput" type="text" placeholder="æœå°‹å–®å­—/æ„æ€/ä¾‹å¥â€¦"/>
      </label>
      <label class="pill" title="åˆ‡æ›é¡¯ç¤º/éš±è—å‡åï¼ˆãµã‚ŠãŒãªï¼‰">
        å‡å <input id="kanaToggle" type="checkbox"/>
      </label>
      <div class="sliders pill" title="èª¿æ•´æœ—è®€é€Ÿåº¦èˆ‡éŸ³é‡ï¼ˆæœƒè¨˜ä½åå¥½ï¼‰">
        <label>é€Ÿåº¦ <input id="rate" type="range" min="0.6" max="1.6" step="0.1" value="1"/></label>
        <label>éŸ³é‡ <input id="volume" type="range" min="0" max="1" step="0.05" value="1"/></label>
      </div>
      <div class="seg" id="modeSeg" role="tablist" aria-label="ç·´ç¿’æ¨¡å¼">
        <button type="button" data-mode="both" class="active" aria-selected="true">é¡¯ç¤ºå…¨éƒ¨</button>
        <button type="button" data-mode="cn" aria-selected="false">æ—¥â†’ä¸­ï¼ˆéš±ä¸­æ–‡ï¼‰</button>
        <button type="button" data-mode="jp" aria-selected="false">ä¸­â†’æ—¥ï¼ˆéš±æ—¥æ–‡ï¼‰</button>
      </div>
    </div>
  </header>

  <table id="vocabTable">
    <tr>
      <th>å–®å­—ï¼ˆæ—¥æ–‡ï¼‰</th>
      <th>ä¸­æ–‡æ„æ€</th>
      <th>ä¾‹å¥ï¼ˆæ—¥æ–‡ï¼‰</th>
      <th>ä¸­æ–‡ç¿»è­¯</th>
    </tr>

    <!-- ====== ä½ çš„ç¬¬8èª²è³‡æ–™ï¼ŒåŸå°ä¿ç•™ï¼ˆç•¥ï¼‰ã€‚åªç¤ºç¯„å‰å¹¾æ¢ï¼Œå…¶ä»–è«‹ç…§åŸæœ¬è²¼ä¸Š ====== -->
    <tr>
      <td class="jp" onclick="speakJP('ãƒãƒ³ã‚µãƒ ')">ãƒãƒ³ã‚µãƒ </td>
      <td>è‹±ä¿Š</td>
      <td class="jp" onclick="speakJP('ã‹ã‚Œã¯ ãƒãƒ³ã‚µãƒ ã§ã™ã€‚')">ã‹ã‚Œã¯ ãƒãƒ³ã‚µãƒ ã§ã™ã€‚</td>
      <td>ä»–å¾ˆè‹±ä¿Šã€‚</td>
    </tr>

    <tr>
      <td class="jp" onclick="speakJP('ãã‚Œã„')">ãã‚Œã„</td>
      <td>æ¼‚äº®</td>
      <td class="jp" onclick="speakJP('ã«ã‚ã¯ ãã‚Œã„ã§ã™ã€‚')">ã«ã‚ã¯ ãã‚Œã„ã§ã™ã€‚</td>
      <td>åº­é™¢å¾ˆæ¼‚äº®ã€‚</td>
    </tr>

    <tr>
      <td class="jp" onclick="speakJP('ã—ãšã‹')"><ruby><rb>é™</rb><rt>ã—ãš</rt></ruby>ã‹ï¼ˆ<span>ãª</span>ï¼‰</td>
      <td>å®‰éœ</td>
      <td class="jp" onclick="speakJP('ã“ã® ã¸ã‚„ã¯ ã—ãšã‹ã§ã™ã€‚')">ã“ã® ã¸ã‚„ã¯ ã—ãšã‹ã§ã™ã€‚</td>
      <td>é€™å€‹æˆ¿é–“å¾ˆå®‰éœã€‚</td>
    </tr>

    <!-- â€¦â€¦æŠŠä½ åŸæœ¬è²¼çš„æ‰€æœ‰ <tr> å…§å®¹ç¹¼çºŒæ”¾åœ¨é€™è£¡å³å¯ï¼ˆä¸éœ€æ”¹å‹•ï¼‰ â€¦â€¦ -->

    <tr><td class="jp" onclick="speakJP('ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³')">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</td><td>é¤å»³</td><td class="jp" onclick="speakJP('ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã§ ã°ã‚“ã”ã¯ã‚“ã‚’ ãŸã¹ã¾ã™ã€‚')">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã§ ã°ã‚“ã”ã¯ã‚“ã‚’ ãŸã¹ã¾ã™ã€‚</td><td>åœ¨é¤å»³åƒæ™šé¤ã€‚</td></tr>
  </table>

  <div class="button-home">
    <a href="index.html">å›é¦–é  ğŸ </a>
  </div>

  <script>
    let voicesLoaded = false;

    // åå¥½ keysï¼ˆèˆ‡ç¬¬1èª²ç›¸åŒï¼Œæ–¹ä¾¿å…¨ç«™å…±ç”¨ï¼‰
    const KANA_KEY = 'showKana';
    const RATE_KEY = 'ttsRate';
    const VOL_KEY  = 'ttsVolume';
    const MODE_KEY = 'practiceMode';

    function getRate(){ const r = parseFloat(localStorage.getItem(RATE_KEY) ?? '1'); return isNaN(r)?1:r; }
    function getVolume(){ const v = parseFloat(localStorage.getItem(VOL_KEY) ?? '1'); return isNaN(v)?1:v; }

    // èªéŸ³ï¼ˆja-JPï¼‰
    function speakJP(text){
      if(!voicesLoaded){
        window.speechSynthesis.onvoiceschanged = ()=>{ voicesLoaded = true; speakJP(text); };
        speechSynthesis.getVoices(); return;
      }
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'ja-JP';
      u.rate = getRate();
      u.volume = getVolume();
      const v = speechSynthesis.getVoices().find(v=>v.lang==='ja-JP');
      if(v) u.voice = v;
      speechSynthesis.speak(u);
    }

    // å‡ååˆ‡æ›
    function applyKanaPreference(show){
      document.body.classList.toggle('hide-kana', !show);
      const t = document.getElementById('kanaToggle'); if(t) t.checked = show;
    }

    // ç·´ç¿’æ¨¡å¼
    function applyPracticeMode(mode){
      document.body.classList.remove('mode-cn','mode-jp');
      if(mode==='cn') document.body.classList.add('mode-cn');
      if(mode==='jp') document.body.classList.add('mode-jp');
      // segmented ç‹€æ…‹
      document.querySelectorAll('#modeSeg button').forEach(btn=>{
        const active = btn.dataset.mode===mode;
        btn.classList.toggle('active', active);
        btn.setAttribute('aria-selected', String(active));
      });
    }

    // å³æ™‚æœå°‹
    function setupSearch(){
      const input = document.getElementById('searchInput');
      const rows = Array.from(document.querySelectorAll('#vocabTable tr')).slice(1);
      input.addEventListener('input', ()=>{
        const q = input.value.trim().toLowerCase();
        rows.forEach(tr=>{
          const hit = tr.textContent.toLowerCase().includes(q);
          tr.style.display = hit ? '' : 'none';
        });
      });
    }

    // è®“æ‰€æœ‰æ—¥æ–‡æ¬„çš„å–®å…ƒæ ¼ï¼ˆtd.jpï¼‰å¯é»æ“Šæœ—è®€
    function delegateSpeak(){
      document.addEventListener('click', e=>{
        const cell = e.target.closest('td.jp');
        if(!cell) return;
        const txt = cell.innerText.replace(/[ï¼ˆï¼‰\[\]]/g, '').trim();
        if(txt){
          speechSynthesis.cancel();
          setTimeout(()=>speakJP(txt), 80);
        }
      });
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      // åˆå§‹åŒ–èªéŸ³
      const check = () => {
        if (speechSynthesis.getVoices().length > 0) voicesLoaded = true;
        else setTimeout(check, 120);
      }; check();

      // å‡ååå¥½
      const savedKana = localStorage.getItem(KANA_KEY);
      const showKana = savedKana===null ? true : savedKana==='true';
      applyKanaPreference(showKana);
      document.getElementById('kanaToggle').addEventListener('change', e=>{
        const show = e.target.checked;
        applyKanaPreference(show);
        localStorage.setItem(KANA_KEY, String(show));
      });

      // TTS åå¥½
      const rateEl = document.getElementById('rate');
      const volEl  = document.getElementById('volume');
      rateEl.value = String(getRate());
      volEl.value  = String(getVolume());
      rateEl.addEventListener('input', ()=> localStorage.setItem(RATE_KEY, rateEl.value));
      volEl.addEventListener('input',  ()=> localStorage.setItem(VOL_KEY,  volEl.value));

      // ç·´ç¿’æ¨¡å¼
      const savedMode = localStorage.getItem(MODE_KEY) ?? 'both';
      applyPracticeMode(savedMode);
      document.querySelectorAll('#modeSeg button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const mode = btn.dataset.mode;
          applyPracticeMode(mode);
          localStorage.setItem(MODE_KEY, mode);
        });
      });

      // æœå°‹ + é»æ“Šæœ—è®€
      setupSearch();
      delegateSpeak();
    });
  </script>
</body>
</html>
